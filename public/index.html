<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>AI Mockup Generator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; background:#111; color:#fff; }
    .wrap { max-width: 960px; margin: 0 auto; padding: 24px; }
    h1 { margin: 0 0 8px; font-size: 22px; }
    p { margin: 0 0 16px; opacity: .85; }
    .row { display:flex; gap:12px; align-items:center; flex-wrap:wrap; margin:12px 0; }
    input[type="file"] { background:#1a1a1a; padding:10px; border-radius:8px; }
    select, button { padding:10px 14px; border-radius:8px; border:0; background:#2a2a2a; color:#fff; }
    button { cursor:pointer; }
    .grid { display:grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap:12px; margin-top:16px; }
    .grid img { width:100%; height:180px; object-fit:cover; border-radius:8px; background:#222; }
    .bar { padding:12px; background:#222; color:#0f0; border-radius:8px; margin-bottom:12px; }
    .err { color:#f66; margin-top:8px; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="bar">App loaded — if nothing happens on Generate, we’ll check the console.</div>

    <h1>AI Mockup Generator</h1>
    <p>Upload your design, pick a product, and generate mockups.</p>

    <div class="row">
      <input id="file" type="file" accept="image/*" />
      <select id="product">
        <option value="ornament">Ornament</option>
        <option value="mug">Mug</option>
        <option value="pillow">Pillow</option>
      </select>
      <button id="go">Generate Mockups</button>
      <span id="status" style="opacity:.7;"></span>
    </div>

    <div id="error" class="err"></div>
    <div id="grid" class="grid"></div>
  </div>

  <script>
    const API_URL = "/api/generate-mockups";
    const $ = (id) => document.getElementById(id);
    const fileEl = $("file");
    const prodEl = $("product");
    const goEl = $("go");
    const gridEl = $("grid");
    const errEl = $("error");
    const statusEl = $("status");

    async function generate() {
      errEl.textContent = "";
      gridEl.innerHTML = "";
      const file = fileEl.files && fileEl.files[0];
      if (!file) { errEl.textContent = "Please upload a design file."; return; }

      goEl.disabled = true;
      statusEl.textContent = "Generating…";

      try {
        const form = new FormData();
        form.append("image", file);
        form.append("product", prodEl.value);

        const res = await fetch(API_URL, { method: "POST", body: form });
        const data = await res.json();
        if (!res.ok) throw new Error(data?.error || "Generation failed");

        // Accept either an array of URLs or {mockups:[...]}
        const urls = Array.isArray(data) ? data : (data.mockups || []);
        if (!urls.length) {
          errEl.textContent = "No mockups returned.";
        } else {
          gridEl.innerHTML = "";
          urls.forEach((url) => {
            const img = document.createElement("img");
            img.src = url;
            gridEl.appendChild(img);
          });
        }
      } catch (e) {
        errEl.textContent = e.message || String(e);
        console.error(e);
      } finally {
        goEl.disabled = false;
        statusEl.textContent = "";
      }
    }

    goEl.addEventListener("click", generate);
  </script>
</body>
</html>
